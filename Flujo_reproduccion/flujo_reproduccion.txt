- Flujo detallado

1. El Cliente invoca load_track(track_id) en MediaRender
Esta llamada se realiza mediante una invocación remota Ice.

2. MediaRender solicita información de la pista al MediaServer

MediaRender llama a get_track_info(track_id) en MediaServer.

MediaServer busca la pista en su biblioteca (self.library) y devuelve un objeto TrackInfo.

3. MediaRender almacena la pista como pista actual

Guarda la información recibida en self.current_track.

4. MediaRender solicita la apertura del stream de audio
Llama a open_stream(track_id, render_identity) en MediaServer.

MediaServer crea internamente un StreamedFile asociado a ese render y devuelve OK.

5. MediaRender confirma la carga al Cliente

Devuelve OK al Cliente indicando que la pista está lista.

6. El Cliente invoca play() en MediaRender

MediaRender inicializa el GstPlayer.

Se lanza un hilo interno encargado de solicitar fragmentos de audio.

7. Bucle de streaming de audio (en un thread del MediaRender)

MediaRender solicita repetidamente get_audio_chunk() al MediaServer.

MediaServer responde con bloques de audio (bytes[4096]).

Este intercambio se repite varias veces.

8. Fin del stream

MediaServer devuelve bytes[0] indicando fin del archivo.

MediaRender emite la señal track_exhausted.


- Ejecución del programa
- Preparación
1. Limpiar estado previo
    ./scripts/stop_python.py
    rm -rf registry_data/ node*_data/ *.log

2. Asegurar que media existe
    make media

3. Iniciar sistema
    ./scripts/start-all.sh

- Flujo de ejecución
1. Mostrar procesos corriendo:
    pgrep -fa icegrid

2. Verificar estado con icegridadmin:
    icegridadmin --Ice.Default.Locator="SpotificeGrid/Locator:tcp -h localhost -p 4061" \
     -u admin -p admin

    >>> application list
    >>> server list
    >>> server state MediaServer-1
    >>> node list
    >>> node show node1
    >>> server start MediaServer-1
    >>> server stop MediaServer-1
    >>> exit

3. Mostrar logs:
    cat mediaserver1.log
    cat mediarender1.log

4. Ejecutar cliente de línea de comandos:
    ./media_control_grid.py

5. Ejecutar interfaz gráfica:
    python3 media_control_v1.py control_gui.config

6. Simular fallo de servidor:
    pkill -9 -f media_server.py
